# CS3611 邮件系统项目

## 1. 项目概述

本项目是一个基于 SMTP/POP3 协议的完整邮件系统。根据课程设计要求，我们实现了邮件的发送、接收、加密、存储等核心功能，并完成了多项扩展任务，包括 **PGP端到端加密**、**垃圾邮件过滤**、**邮件撤回** 和 **Web邮件界面**。

系统支持 SSL/TLS 安全传输，并通过高并发优化，确保了在多用户场景下的稳定运行。

## 2. 功能特性

本项目完整实现了课程要求的各项功能：

| 功能类别     | 特性                                             | 完成情况 |
| :----------- | :----------------------------------------------- | :------- |
| **基础功能** | **SMTP/POP3 协议**：支持邮件发送与接收。         | ✅ 已完成 |
|              | **MIME 协议**：支持 HTML 邮件及多种格式附件。    | ✅ 已完成 |
|              | **用户认证**：支持明文及加密登录。               | ✅ 已完成 |
|              | **本地存储**：邮件可保存为 `.eml` 文件。         | ✅ 已完成 |
|              | **并发服务**：服务端支持多用户同时操作。         | ✅ 已完成 |
| **安全机制** | **SSL/TLS 加密**：保障客户端与服务器的通信安全。 | ✅ 已完成 |
| **扩展功能** | **PGP 端到端加密**：确保邮件内容仅收发双方可见。 | ✅ 已完成 |
|              | **垃圾邮件过滤**：基于关键词识别并标记垃圾邮件。 | ✅ 已完成 |
|              | **邮件撤回功能**：实现了服务器端邮件撤回。       | ✅ 已完成 |
|              | **Web 邮件界面**：提供图形化浏览器操作界面。     | ✅ 已完成 |

## 3. 用户手册与快速开始

请按照以下步骤来运行和体验本系统。

### 第一步：环境配置

首先，请确保您的环境中已安装 **Python 3.8 或更高版本**。

然后，在项目根目录打开终端，运行以下命令安装所需依赖：
```bash
pip install -r requirements.txt
```

### 第二步：初始化系统

接下来，运行初始化脚本。此脚本将创建数据库、生成测试账户和必要的SSL证书。
```bash
python init_project.py
```

### 第三步：使用客户端体验功能

我们提供多种客户端来体验邮件收发功能。

#### 方式一：Web 界面 (推荐)

Web 界面提供了最直观的操作方式，适合快速上手。运行以下命令启动 Web 服务：
```bash
python run_simple_web.py
```
然后在浏览器中访问 `http://127.0.0.1:5000` 即可开始使用。

#### 方式二：统一命令行界面 (CLI)

如果您偏好命令行操作，可以使用我们统一的 CLI 入口：
```bash
python cli.py
```
它将提供一个交互式菜单，引导您完成邮件收发、账户管理等操作。

#### 方式三：SMTP/POP3 命令行客户端

如果您想手动测试 SMTP/POP3 协议，可以使用我们提供的 SMTP/POP3 命令行客户端。

运行以下命令，一键启动 SMTP 和 POP3 服务器：
```bash
python examples/example_run_both_servers.py
```
服务器启动后，将在本地监听以下端口：
- **SMTP 服务器**: `localhost:8025` (非加密), `localhost:465` (SSL)
- **POP3 服务器**: `localhost:8110` (非加密), `localhost:995` (SSL)


### 客户端配置说明 (关键信息)

- **服务器IP地址**: `localhost` 或 `127.0.0.1`
- **默认测试账户**:
  - 用户名: `testuser`
  - 密码: `testpass`
- **SSL 证书导入**:
  - 本项目使用的自签名证书位于 `./certs/` 目录下。
  - 我们提供的客户端在连接 SSL 端口 (如 `465`, `995`) 时会自动处理证书验证，无需手动导入。
  - 若使用第三方邮件客户端（如 Outlook, Foxmail）连接，则需要将 `./certs/ca.crt` 证书导入到您的系统的"受信任的根证书颁发机构"中。

## 4. 核心功能演示指南

以下是如何验证本项目的核心功能：

### 发送带附件的邮件

1.  使用 **Web 界面** 或 **CLI 客户端** 登录测试账户。
2.  撰写一封新邮件，添加任意附件（如图片、PDF文档）。
3.  发送邮件后，登出当前账户。
4.  使用同一账户再次登录，通过 POP3 协议接收邮件。
5.  您将能看到接收到的邮件内容，并可成功下载和查看附件，验证 MIME 结构被完整解析。

### SSL 加密传输验证

1.  客户端在连接 `localhost:465` (SMTPs) 或 `localhost:995` (POP3s) 时，将自动启用 SSL/TLS 加密。
2.  **安全效果**：在 SSL/TLS 保护下，所有通信内容（包括登录凭据和邮件正文）都是加密的。如果此时有中间人进行网络嗅探（如使用 Wireshark 抓包），将只能看到无意义的加密报文，无法窃取敏感信息，从而有效防止了中间人攻击。

### PGP 端到端加密演示

我们提供了专门的脚本来一键演示 PGP 功能。
运行以下命令：
```bash
# 此脚本将自动完成：生成PGP密钥 -> 加密发送 -> 解密接收 的全过程
python demo_pgp_with_auth.py
```
您也可以通过 PGP 命令行客户端 (`python pgp_cli.py`) 手动体验，测试账户为 `pgptest` / `pgp123`。

## 5. 开发信息

### 项目结构
```
├── server/          # 服务器模块 (SMTP/POP3)
├── client/          # 客户端模块 (SMTP/POP3/MIME)
├── pgp/             # PGP 端到端加密模块
├── spam_filter/     # 垃圾邮件过滤模块
├── examples/        # 运行示例脚本
├── tests/           # 自动化测试脚本
├── docs/            # 详细设计文档
├── templates/       # Web 界面模板
└── certs/           # SSL 证书文件
```

### 运行自动化测试
```bash
# 运行完整的集成测试
python tests/integration/comprehensive_system_test.py

# 运行并发性能测试
python tests/performance/test_enhanced_concurrency.py
```

## 6. 许可证

本项目基于 MIT 许可证开源。
